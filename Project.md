# Project_X CRM
1. [Задание на разработку](#1) 
2. [Use Case диаграмма](#2)
3. [Доменная модель](#3) 
4. [Оценка сторонних решений (подрядчиков)](#4)
5. [Архитектура БД](#5)	
6. [Deploy Diagram](#6)

## Задание на разработку 
### Вводные данные:
Имеется система CRM для телекоммуникационной компании с количеством операторов в 100 человек.
CRM состоит из:
* Клиентов (физические и юридические лица)
* Заказов (заказы на услуги, предоставляемые компанией клиенту)
* Обращений (обращения в техническую поддержку)
* Менеджера задач (Kanban-доска для отработки обращений, содержит доски, задачи, витрину с динамическими фильтрами)

### WorkFlow:
* Пользователь авторизуется в CRM
  * Профиль пользователя;
  * Уведомления пользователя.
* Пользователю доступны клиенты
  * Возможность просматривать список клиентов;
  * Возможность поиска по имени клиента;
  * Возможность редактировать клиента;
  * Возможность создавать клиента.
* Пользователю доступны заказы
  * Возможность просматривать список заказов по клиенту;
  * Возможность просматривать список заказов;
  * Возможность поиска заказа;
  * Возможность создавать заказ на клиента.
* Пользователю доступны обращения
  * Возможность просматривать обращения;
  * Возможность создавать обращение на клиента;
  * Возможность закрывать обращение.
* Пользователю доступен менеджер задач
  * Пользователю создается доска;
  * При создании обращения на доске создается задача;
  * У задачи имеется бизнес-процесс;
  * По завершению задачи, она закрывается, автоматически закрывается обращение, нотифицируется (менеджеру, клиенту).
* Имеется интеграция во внешние системы(входящая/исходящая)
Менеджер задач содержит витрину, на которой отображается информация по задачам. Применяются динамические фильтры.

Время отклика не более 1 секунды. Система должна быть отказоустойчивой (выбрать способ) и высоконагруженной (500 rps);

### Решаемые задачи:
1. Разработать доменную модель (любая нотация);
2. Выработать единую архитектуру (монолит, SOA, MSA), с описанием, почему выбран именно такой подход;
3. Подготовить оптимальное интеграционное решение;
4. Выбрать способ обеспечения отказоустойчивости и работы под нагрузкой;
5. Реализовать блок-схему\диаграмму архитектурного решения, возможно по этапам Day 0-Daу 2;
6. Выбрать Языки и Стек технологий c альтернативным решением (основная технология + альтернативная технология) с таблицей сравнительной оценки предпочтительной (из лекции 5, модуля 4, в приложении), дать оценку для 1,2-х главных технологий.
7. Оценить техническую инфраструктуру, вычислители, ОЗУ, долговременное хранилище, сеть, на период 5 лет эксплуатации.
8. Дополнительно: оценить общую трудоёмкость решения (должности в разработке и человеко/месяцы трудозатрат)

## Use Case диаграмма
![Use-Case](/Use-case.png)	

## Доменная модель
### Поддомены
####  Бизнес
* Клиент - физические или юридические лица, покупатели услуг. 
* Услуга - основной источник денежных средств в данном случае основной продукт компании
* Заказ - сущность объединяющая несколько услуг, для одного клиента
* Обращение - любой контакт клиента с системой
* Уведомление - 
* Задача - действие/действия, которые необходимо выполнить для оказания услуги клиенту
* Доска задач - список задач, которые необходимо выбрать пользователю
* Бизнесс-процесс - последовательность действий которые необходимо выполнить в рамках задачи

| Определение      | Сущности и Агрегаты | Модуль |
|:--|:--|:--|
|Клиент|Client|Clients|
|Услуга|Service|Products|
|Заказ|Order|Orders|
|Обращение|Appeal|Appeals|
|Уведомление|Notification|Notifications|
|Задача|Task|Tasks|
|Доска задач|Board|Boards|
|Бизнесс-процесс|BuisnessProc|BuisnessProcs|

#### Безопасность
* Пользователь - пользователь системы, 
* Полномочие - атомарное разрешение на выполнение какого-либо действия в системе;
* Роль - набор полномочий объединенных под одним именем.

| Определение      | Идентификатор   | Модуль |
|:--|:--|:--|
|Пользователь|User|Users|
|Полномочие|Entitlement|Entitlements|
|Роль|Role|Roles|

В системе определены 3 роли: 
* Администратор - имеет полномочия на присвоение ролей оператора;
* Оператор - имеет права на операции с объектами модулей Clients, Products, Appeals, Notification, Task, TaskBoard

#### Инфраструктура и интеграция
* *Источник пользователей* - в Project_X CRM источником пользователей может служить как внутренняя БД самой системы, так и СКП. Для упрощения реализации пользователи и роли должны поступать из одного источникаотсутствует возможность иметь разные источники пользователей и ролей (может быть рассмотрена в развитии системы, однако реализация представляется не целесообразной);
* Источник ролей - источником ролей может служить как внутренняя БД самой системы, так и СКП; 
* Источник клиентов;
* Источник заказов;
* Источник настроек; 
* Хост - реальная или виртуальная ЭВМ на которой выполняются один или несколько компонентов системы;
* Порт - адрес на хосте для приёма/получения данных;
* Интеграционный пользователь - учётная запись от имени которой выполняются действия в сторонней системе интегрированной с Project_X;
* Интеграционная роль - набор полномочий достаточный для выполнения необходимых функций в интегрируемой системе;
* Служба каталогов пользователей (далее СКП) - служба-поставщик идентификационных, аутентификационных и авторизационных данных. Может быть построена на любой распространённой технологии, например LDAP

Интеграционный пользователь и интеграционная роль реализуются встроенными механизмами интегрируемых систем и служат только для связи систем между собой

| Определение      | Идентификатор   |
|:--|:--|
|Служба пользователей|UsersService|
|Служба ролей|RolesService|
|Служба полномочий|EntitlementsService|
|Служба клиентов|ClientsService|
|Служба заказов|ОrdersService|
|Служба услуг|ProductsService|
|Служба обращений|AppealsService|
|Служба уведомлений|NotificationsService|
|Служба задач|TasksService|
|Служба досок|BoardsService|
|Служба бизнесс-процессов|BusinessProcService|

### DFD
![dfd](https://user-images.githubusercontent.com/13516836/167880160-9414b232-3616-4a1b-8e98-98dfb6cba0f0.png)

### Sequence diagram
![sequence](https://user-images.githubusercontent.com/13516836/167880213-56828d8e-a380-48a9-ac8d-cee4a04124a1.png)

### Ограниченные контексты
Для всех ограниченных контекстов существует следующий набор операций:
| Операция      | Комментарий   |
|:--|:--|
|create| В случае сущности - создаёт новую сущность. В случае агрегата - создаёт связь сущностей в агрегате |
|update| В случае сущности - изменяет созданную ранее сущность. В случае агрегата обычно смысла не имеет |
|delete| В случае сущности - удаляет созданную ранее сущность. В случае агрегата разрывает связь сущностей в агрегате|
|search| Ищет сущности или агрегат|
|getInfo| Получает информацию о сущности или агрегате|


### Ограниченный контекст поддомена "Бизнес"
#### Client
По данным ТЗ Клиенты поставляются из legacy-компонета. Использование такого интерфейса как Источник клиентов позволяет модернизировать систему на получение клиентов из другого источника, например из собственной БД. 

#### Order
По данным ТЗ Заказы поставляются из legacy-компонент. Использование такого интерфейса как Источник заказов позволяет модернизировать систему для получения заказов из другого источника, например из собственной БД.

#### Product
По данным ТЗ Источником Услуг является legacy-компонент "Заказы" поэтому операции **create**, **update**, **delete** для услуг не имеют смысла. Для услуг имеет смысл операций **search** и **getInfo** для поиска услуги необходимой клиенту и получение информации о ней. Использование соответствующего интерфейса позволит в будущем получать услуги из другого источника, например из корпоративной MDM системы.

#### Appeal
При реализации предполагается, что источником обращений можем быть Оператор, E-mail клиента - в этом случае письмо должно прийти с зарегистрированного почтового адреса однозначно определяющего идентичность клиента, телефонный звонок клиента на автоматическую линию поддержки - в случае если клиент согласился воспользоваться услугами автомата.

#### Notification
По уточнённым требованиям (блок 2 вопрос 3) уведомления должны рассылаться как пользователям системы о получении заявки в техподдержки так и клиенту - о текущем статусе задачи. Реализована отправка сообщений по E-mail и SMS. Для уведомлений добавляется операция отсылки сообщений - **send**. 

#### Task
Особенности реализации отсутствуют

#### Board
Особенности реализации отстутствуют

#### BuisnessProc
Особенности реализации отсутствуют

### Ограниченный контекст поддомена "Безопасность"
#### User
В целях дальнейшей интеграции с уже имеющейся корпоративной средой предусмотрена возможность выбирать источник, который будет поставлять пользователей в систему. Таким источником может быть встроенная БД Project_X CRM. В этом случае предоставляется API необходимое для обработки пользователей в системе как с помощью встроенного интерфейса, так и посредством корпоративной системы управления пользователями (IDM). Источником пользователей может быть СКП. В этом случае на операции create, update, delete выполняются на стороне СКП.

#### Role
Так же как и Пользователей для Ролей предусмотрен выбор источника между встроенной БД системы и СКП. В случае если источником ролей является СКП сreate, update, delete выполняются на стороне её стороне.

#### Entitlement
Список полномочий жестко заданы во внутренней базе данных системы. Их состав зависит от текущей версии приложения и от объектов развернутых в системе.

#### Агрегат RoleEntitlements
Агрегат отражает отношения Роли и Полномочия. Вне зависимости от источника, из которого пришла роль данный агрегат сохраняется во внутренней БД. Операция create добавляет Полномочие в Роль, операция delete - удаляет Полномочие из Роли.

#### Агрегат UserRoles
Агрегат отражает отношения пользователя системы и назначенных ему ролей. Агрегат может как формироваться в БД системы, так и поставляться из СКП. В этом случае операции create и delete не имеют смысла, а реализуются сторонними средствами в СКП.


![Диаграмма классов](/ClassDiagram.svg)	
	



##### Операции
* Clients.create(ClientsSource cs, Client cl)
* Clients.update(ClientsSource cs, Client cl)
* Clients.delete(ClientsSource cs, long id)
* Clients.search(ClientsSource cs, List<String> fieldsNames, String criteria)
* Clients.getInfo(ClientsSource cs, long id)


Сущности и их поля (базовые):
Пользователь
	ФИО - String
	id - int
	роль - dict(role: string - id: int)


Клиент
	ФИО
	id
	Данные (паспорт, телефон)
	тип 
	

Задача
	id 
	тип
	id исполнителя
	описание
	время исполнения
	статус

Заказ
	id 
	тип
	id клиента
	id задачи
	описание
	сумма
	статус
	
## Оценка сторонних решений (подрядчиков)
	
[Оценка подрядчиков.pdf](https://github.com/LordOfPhys/project_x/files/8769291/default.pdf)
	
	
## Архитектура БД
![DB](/db.png)	
	
## Deploy Diagram
![DD](/DeployDiagram.png)	

