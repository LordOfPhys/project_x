# Project_X CRM
1. [Задание на разработку](#%D1%82%D0%B7) 
2. [Разработки группы](#%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D0%BA%D0%B8-%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D1%8B)
3. [Доменная модель](#%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C) 

## ТЗ 
### Вводные данные:
Имеется система CRM для телекоммуникационной компании с количеством операторов в 100 человек.
CRM состоит из:
* Клиентов (физические и юридические лица)
* Заказов (заказы на услуги, предоставляемые компанией клиенту)
* Обращений (обращения в техническую поддержку)
* Менеджера задач (Kanban-доска для отработки обращений, содержит доски, задачи, витрину с динамическими фильтрами)

### WorkFlow:
* Пользователь авторизуется в CRM
  * Профиль пользователя;
  * Уведомления пользователя.
* Пользователю доступны клиенты
  * Возможность просматривать список клиентов;
  * Возможность поиска по имени клиента;
  * Возможность редактировать клиента;
  * Возможность создавать клиента.
* Пользователю доступны заказы
  * Возможность просматривать список заказов по клиенту;
  * Возможность просматривать список заказов;
  * Возможность поиска заказа;
  * Возможность создавать заказ на клиента.
* Пользователю доступны обращения
  * Возможность просматривать обращения;
  * Возможность создавать обращение на клиента;
  * Возможность закрывать обращение.
* Пользователю доступен менеджер задач
  * Пользователю создается доска;
  * При создании обращения на доске создается задача;
  * У задачи имеется бизнес-процесс;
  * По завершению задачи, она закрывается, автоматически закрывается обращение, нотифицируется (менеджеру, клиенту).
* Имеется интеграция во внешние системы(входящая/исходящая)
Менеджер задач содержит витрину, на которой отображается информация по задачам. Применяются динамические фильтры.

Время отклика не более 1 секунды. Система должна быть отказоустойчивой (выбрать способ) и высоконагруженной (500 rps);

### Решаемые задачи:
1. Разработать доменную модель (любая нотация);
2. Выработать единую архитектуру (монолит, SOA, MSA), с описанием, почему выбран именно такой подход;
3. Подготовить оптимальное интеграционное решение;
4. Выбрать способ обеспечения отказоустойчивости и работы под нагрузкой;
5. Реализовать блок-схему\диаграмму архитектурного решения, возможно по этапам Day 0-Daу 2;
6. Выбрать Языки и Стек технологий c альтернативным решением (основная технология + альтернативная технология) с таблицей сравнительной оценки предпочтительной (из лекции 5, модуля 4, в приложении), дать оценку для 1,2-х главных технологий.
7. Оценить техническую инфраструктуру, вычислители, ОЗУ, долговременное хранилище, сеть, на период 5 лет эксплуатации.
8. Дополнительно: оценить общую трудоёмкость решения (должности в разработке и человеко/месяцы трудозатрат)

### Отчётные документы:
1. Документы должны содержать следующие диаграммы: Use Case, ERD, DFD, Sequence Diagram (общая и несколько детальных), Class Diagram, Component Diagram, Deploy Diagram, Интеграционную диаграмму, Архитектуру БД;
2. Подготовить документацию API (Swagger);
3. Результат представить в виде 2-х документов:
  * Текстовый документ формата A4 c диаграммами, таблицами и комментариями.
  * Презентация по ключевым диаграммам и идеям. 
Компоненты Клиент и Заказы являются legacy с более старым стеком. Попробовать внедрить legacy в новую архитектуру.

## Разрабоки группы
* [Заготовка к презентации](https://docs.google.com/presentation/d/1y6QWRaDwOO5-LOeqW3I-x9YwzwfJVJZlM5_qJC_9oBw/edit?usp=sharing)
* [Схемы](https://drive.google.com/file/d/167fYQh3RjtNu08GgwGgpsxvGoYCHqj8s/view?usp=sharing)

## Доменная модель
### Поддомены
####  Бизнес
* Клиент - физические или юридические лица, покупатели услуг. 
* Услуга - основной источник денежных средств в данном случае основной продукт компании
* Заказ - сущность объединяющая несколько услуг, для одного клиента
* Обращение - любой контакт клиента с системой
* Уведомление - 
* Задача - действие/действия, которые необходимо выполнить для оказания услуги клиенту
* Доска задач - список задач, которые необходимо выбрать пользователю

| Определение      | Идентификатор   | Модуль |
|:--|:--|:--|
|Клиент|Client|Clients|
|Услуга|Service|Products|
|Заказ|Order|Orders|
|Обращение|Appeal|Appeals|
|Уведомление|Notification|Notifications|
|Задача|Task|Tasks|
|Доска задач|Board|Boards|

#### Безопасность
* Пользователь - пользователь системы, 
* Полномочие - атомарное разрешение на выполнение какого-либо действия в системе;
* Роль - набор полномочий объединенных под одним именем.

| Определение      | Идентификатор   | Модуль |
|:--|:--|:--|
|Пользователь|User|Users|
|Полномочие|Entitlement|Entitlements|
|Роль|Role|Roles|

В системе определены 3 роли: 
* Администратор - имеет полномочия на присвоение ролей оператора;
* Оператор - имеет права на операции с объектами модулей Clients, Products, Appeals, Notification, Task, TaskBoard

#### Инфраструктура и интеграция
* *Источник пользователей* - в Project_X CRM источником пользователей может служить как внутренняя БД самой системы, так и СКП. Для упрощения реализации пользователи и роли должны поступать из одного источникаотсутствует возможность иметь разные источники пользователей и ролей (может быть рассмотрена в развитии системы, однако реализация представляется не целесообразной);
* Источник ролей - источником ролей может служить как внутренняя БД самой системы, так и СКП; 
* Источник клиентов;
* Источник заказов;
* Источник настроек; 
* Хост - реальная или виртуальная ЭВМ на которой выполняются один или несколько компонентов системы;
* Порт - адрес на хосте для приёма/получения данных;
* Интеграционный пользователь - учётная запись от имени которой выполняются действия в сторонней системе интегрированной с Project_X;
* Интеграционная роль - набор полномочий достаточный для выполнения необходимых функций в интегрируемой системе;
* Служба каталогов пользователей (далее СКП) - служба-поставщик идентификационных, аутентификационных и авторизационных данных. Может быть построена на любой распространённой технологии, например LDAP

Интеграционный пользователь и интеграционная роль реализуются встроенными механизмами интегрируемых систем и служат только для связи систем между собой

| Определение      | Идентификатор   |
|:--|:--|
|Источник пользователей|Users source|
|Источник ролей|Roles source|
|Источник клиентов|Clients source|
|Источник заказов|Оrders source|
|Источник обращений|Appeals source|
|Источник уведомлений|Notification source|
|Источник задач|Tasks source|

### DFD
![dfd](https://user-images.githubusercontent.com/13516836/167880160-9414b232-3616-4a1b-8e98-98dfb6cba0f0.png)

### Sequence diagram
![sequence](https://user-images.githubusercontent.com/13516836/167880213-56828d8e-a380-48a9-ac8d-cee4a04124a1.png)

Для всех ограниченных контекстов существует следующий набор операций:
* create - создание сущности или агрегата;
* update - изменение сущности, для агрегата данная операция не поддерживается;
* delete - удаление сущности или агрегата;
* search - поиск сущности или агрегата;
* getInfo - получение данных по идентифиатору.


### Ограниченный контекст поддомена "Бизнес"
#### Clients
По данным ТЗ клиенты поставляются из legacy-компонета. В любом случае обработка каждого клиента предполагает следующий жизненный цикл сущности: 
* сreate - появление в базе данных legacy-компонета нового клиента с первоначальным заполнением данных оператором; 
* Изменение (update) - изменение собственных данных клиента. Для упрощения логики данные изменяются по всему клиенту сразу, соответственно необходима поддержка на стороне legacy-компонента;legacy-компонента;
* Удаление (delete) - удаление клиента из базы данных системы. Для этого необходима соответствущая поддержка на стороне legacy-компонента.
* Поиск (search) - полнотекстовой поиск клиента по совокупности полей.
* Получить данные (getInfo) - получение данных о клиенте по его идентификатору.
Ввиду наличия тесной связи объектоы СдПолезным будет предложить реализовать взаимодействие с источником клиентов с помощью унифицированного интерфейса, в котором можно будет заменить текущую реализацию на получение клиентов из другого источника, например из собственной БД. 

| Операция      | Комментарий   |
|:--|:--|
|create| В случае сущности - создаёт новую сущность. В случае агрегата - создаёт связь сущностей в агрегате |
|update| В случае сущности - изменяет созданную ранее сущность. В случае агрегата обычно смысла не имеет |
|delete| В случае сущности - изменяет созданную ранее сущность. В случае агрегата разрывает связь сущностей в агрегате|
|search| Ищет сущности или агрегат|
|getInfo| Получает информацию о сущности или агрегате|


### Ограниченный контекст поддомена "Безопасность"
#### Users
В целях дальнейшей интеграции с уже имеющейся корпоративной средой предусмотрена возможность выбирать источник, который будет поставлять пользователей в систему. Таким источником может быть встроенная БД Project_X CRM. В этом случае предоставляется API необходимое для обработки пользователей в системе как с помощью встроенного интерфейса, так и посредством корпоративной системы управления пользователями (IDM). Источником пользователей может быть СКП. В этом случае на операции create, update, delete выполняются на стороне СКП.

#### Roles
Так же как и Пользователей для Ролей предусмотрен выбор источника между встроенной БД системы и СКП. В случае если источником ролей является СКП сreate, update, delete выполняются на стороне её стороне.

#### Entitlements
Список полномочий жестко заданы во внутренней базе данных системы. Их состав зависит от текущей версии приложения и от объектов развернутых в системе.

#### Агрегат RoleEntitlements
Агрегат отражает отношения Роли и Полномочия. Вне зависимости от источника, из которого пришла роль данный агрегат сохраняется во внутренней БД. Операция create добавляет Полномочие в Роль, операция delete - удаляет Полномочие из Роли.

#### Агрегат UserRoles
Агрегат отражает отношения пользователя системы и назначенных ему ролей. Агрегат может как формироваться в БД системы, так и поставляться из СКП. В этом случае операции create и delete не имеют смысла, а реализуются сторонними средствами в СКП.


![Диаграмма классов](/ClassDiagram.svg)	
	


##### Операции
* Clients.create(ClientsSource cs, Client cl)
* Clients.update(ClientsSource cs, Client cl)
* Clients.delete(ClientsSource cs, long id)
* Clients.search(ClientsSource cs, List<String> fieldsNames, String criteria)
* Clients.getInfo(ClientsSource cs, long id)


Сущности и их поля (базовые):
Пользователь
	ФИО - String
	id - int
	роль - dict(role: string - id: int)


Клиент
	ФИО
	id
	Данные (паспорт, телефон)
	тип 
	

Задача
	id 
	тип
	id исполнителя
	описание
	время исполнения
	статус

Заказ
	id 
	тип
	id клиента
	id задачи
	описание
	сумма
	статус
	
